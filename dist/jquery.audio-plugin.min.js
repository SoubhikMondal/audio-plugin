!function(t){"use strict";function s(s){var e=Array.prototype.slice.call(arguments,0);return this.each(function(){var r=t(this),o=r.data("MHEAudio");if(o){if("string"==typeof s)return o[s].apply(o,e),o}else r.data("MHEAudio",new i(this,s))})}var i=function(s){return this.$el=t(s),this.playPause=this.$el.find(".playPause"),this.muteUnmute=this.$el.find(".muteUnmute"),this.scrobbler=this.$el.find(".scrobbler"),this.volume=this.$el.find(".volume"),this.audioURL=this.$el.data("audiourl"),this.song=new Audio(this.audioURL),this.song.type=this.$el.data("audiotype"),this.song.src=this.audioURL,this.song.preload="none",this.isMuted=!1,this.isPlaying=!1,this.previousVolume=10,this.scrobblerProxy=null,this.durationProxy=null,this.errorProxy=null,this.errorDuration=0,this.errorTimeOut=5e3,this.playPause.addClass("isPaused"),this.muteUnmute.addClass("isUnmuted"),this.volume.val(this.previousVolume),this.addEvents(),this};i.prototype.addEvents=function(){this.playPause.on("click",t.proxy(this.togglePlayback,this)),this.muteUnmute.on("click",t.proxy(this.toggleVolume,this)),this.volume.on("change",t.proxy(this.updateVolume,this)),this.volume.on("click",t.proxy(this.clickSlider,this)),this.scrobbler.on("change",t.proxy(this.updateSongPosition,this)),this.scrobbler.on("mousedown",t.proxy(this.startDrag,this)),this.scrobbler.on("mouseup",t.proxy(this.stopDrag,this)),this.scrobbler.on("click",t.proxy(this.clickSlider,this)),this.scrobblerProxy=t.proxy(this.updateScrobbler,this),this.song.addEventListener("timeupdate",this.scrobblerProxy),this.errorProxy=t.proxy(this.handleSrcError,this),this.song.addEventListener("error",this.errorProxy),this.durationProxy=t.proxy(this.setDuration,this),this.song.addEventListener("durationchange",this.durationProxy),this.endProxy=t.proxy(this.resetPlayer,this),this.song.addEventListener("ended",this.endProxy)},i.prototype.tearDown=function(){this.playPause.unbind(),this.muteUnmute.unbind(),this.volume.unbind(),this.scrobbler.unbind(),this.song.removeEventListener("timeupdate",this.scrobblerProxy,!1),this.song.removeEventListener("durationchange",this.durationProxy,!1),this.song.removeEventListener("ended",this.endProxy,!1),this.song.removeEventListener("error",this.errorProxy,!1),this.song.src="",this.song=null},i.prototype.handleSrcError=function(s){var i=s.target.error.code;if(4===i||2===i){var e=s.target.src,r=this,o=r.song;r.errorDuration>r.errorTimeOut?(t(r.playPause).removeClass("isPlaying").addClass("inError"),t(r.$el).attr("title","An error occurred while playing your recording. Please try again later.")):setTimeout(function(){r.errorDuration=r.errorDuration+500,o.src=e,o.pause(),o.load(),o.play()},500)}},i.prototype.resetPlayer=function(){this.togglePlayback(),t(this.scrobbler).val(0)},i.prototype.setDuration=function(){t(this.scrobbler).attr("max",this.song.duration)},i.prototype.clickSlider=function(){return!1},i.prototype.startDrag=function(){t(this.scrobbler).attr("max",this.song.duration),this.isPlaying===!0&&this.song.pause()},i.prototype.stopDrag=function(){this.isPlaying===!0&&this.song.play()},i.prototype.updateSongPosition=function(){this.song.currentTime=t(this.scrobbler).val()},i.prototype.updateScrobbler=function(){var s=parseInt(this.song.currentTime,10);t(this.scrobbler).val(s)},i.prototype.togglePlayback=function(){return this.isPlaying===!1?(t(this.playPause).removeClass("isPaused").addClass("isPlaying"),this.song.play(),this.isPlaying=!0):(t(this.playPause).removeClass("isPlaying").addClass("isPaused"),this.song.pause(),this.isPlaying=!1),!1},i.prototype.toggleVolume=function(){return this.isMuted?(this.isMuted=!1,this.song.volume=.1*this.previousVolume,t(this.volume).val(this.previousVolume),t(this.muteUnmute).removeClass("isMuted").addClass("isUnmuted")):(this.isMuted=!0,this.song.volume=0,t(this.volume).val(0),t(this.muteUnmute).removeClass("isUnmuted").addClass("isMuted")),!1},i.prototype.updateVolume=function(){var s=parseInt(t(this.volume).val());this.song.volume=.1*s,0===s?t(this.muteUnmute).removeClass("isUnmuted").addClass("isMuted"):(this.previousVolume=s,t(this.muteUnmute).removeClass("isMuted").addClass("isUnmuted"))},t.fn.mheAudio=s,t.fn.mheAudio.Constructor=i}(jQuery);